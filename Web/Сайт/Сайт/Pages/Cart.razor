@page "/Cart"
@inject Blazored.LocalStorage.ILocalStorageService oLocalStore
@inject UserService Service
@inject NavigationManager NavigationManager

<html>
<body>
    <div class="page-wrapper fhg-content">
        <div class="container page-inner ">

            @*if (корзина пуста)
        {
        <div class="notice notice-info text-center">
            Ваша корзина пуста
        </div>
        }*@
            @if (email == null)
            {
                <div class="notice notice-info text-center aboba">
                    Для продолжения оформления заказа, пожалуйста, авторизуйтесь
                </div>
                <button class="co-button co-button--checkout aboba aboba1" @onclick="click">Личный кабинет</button>
            }
            else if (Header.addcart.Count == 0)
            {
                <div class="notice notice-info text-center aboba">
                    Ваша корзина пуста, добавьте, пожалуйста, товары
                </div>
                <button class="co-button co-button--checkout aboba aboba1" @onclick="clicktocat">Перейти в каталог</button>
            }
            else
            {
                <div class="checkout-v2-wrapper co-section--checkout_content">
                    <div class="co-section--checkout_order co-section--checkout_order_sided">

                        <div class="co-section--checkout_header co-checkout-block--padded">
                            <div class="decorated-title-wrapper co-checkout-title">
                                <h1 class="decorated-title co-title co-title--h1">
                                    Оформление заказа
                                </h1>
                            </div> <!--шапка-->

                        </div>


                        <div class="co-sidebar-wrapper">
                            <div class="co-sidebar co-sidebar--fixed">

                                <div class="co-basket co-checkout-block--padded">


                                    @foreach (var i in Header.addcart)
                                    {
                                        <div class="co-basket_item-list">
                                            <div class="co-basket_item">
                                                <div class="co-basket_item-image_container">
                                                    <div class="co-basket_item-image">
                                                        <img alt="image" src="@i.Picture">
                                                    </div>
                                                </div>
                                                <div class="co-basket_item-description">@i.Name</div>
                                                <div class="co-basket_item-total">
                                                    <span class="co-basket_item-count">@Header.addcartqu[count]</span> x
                                                    <span class="co-basket_item-price co-price--current">@i.Price&nbsp;руб</span>
                                                </div>
                                                <button type="submit" class="item-delete button is-transparent">
                                                    <i class="fa fa-remove"></i>
                                                </button>
                                            </div>
                                        </div>
                                        count++;
                                    }

                                    <div class="co-basket_subtotal-list">

                                        <div class="co-basket_subtotal">
                                            <div class="co-basket_subtotal-title">Сумма по товарам</div>
                                            <div class="co-basket_subtotal-price co-price--current">@summ&nbsp;руб</div>
                                        </div> <!--стоимость товаров-->

                                        <div class="co-basket_subtotal">
                                            <div class="co-basket_subtotal-title">Стоимость доставки</div>
                                            <div class="co-basket_subtotal-price co-price--current">0&nbsp;руб</div>
                                        </div>
                                        <!--стоимость доставки-->

                                    </div>

                                    <div class="co-basket_total">
                                        <div class="co-basket_total-title">Итого:</div>
                                        <div class="co-basket_total-price co-price--current">142989&nbsp;руб</div>
                                    </div> <!--итоговая стоимость-->

                                </div>

                            </div>
                        </div>

                        <form class="co-checkout-order_form co-checkout-block--padded">


                            <div class="co-delivery_method-list co-checkout-block">
                                <div class="co-checkout-block">
                                    <div class="co-client">
                                        <div class="co-client-logged">
                                            Вы авторизовались как
                                            <span class="co-client-name">@name @name2 @name3</span>
                                        </div><div class="co-client-info">
                                            <div class="co-client-field">Номер телефона - @phone</div>
                                            <div class="co-client-field">Email - @email</div>
                                        </div>
                                        <a class="co-button" @onclick="ClearSession">Выход</a>
                                    </div>
                                </div> <!--инф о пользователе-->

                                <h2 class="co-title co-title--h2">Доставка</h2>
                                <div class="co-checkout-block">
                                    <div class="co-input co-input--required">
                                        <input id="shipping_address_country" type="hidden" value="RU">
                                        <div class="co-input co-input--required co-input--text co-input--full_locality_name  co-input--nested">
                                            <label class="co-input-label" for="shipping_address_full_locality_name">Населенный пункт</label>
                                            <input class="co-input-field" value="г Киров, Кировская обл.">
                                        </div>
                                    </div>
                                </div>
                                <div class="variants delivery_variants co-input co-input--required co-input--radio co-tabs" style="z-index: inherit;">
                                    <input name="shipping_address[no_delivery]" type="hidden" value="0">
                                    <input style="display: none" type="checkbox" value="1" checked="checked" name="shipping_address[no_delivery]" id="shipping_address_no_delivery">

                                    <div class="co-tabs-content co-tabs-content--active">

                                        <label class="co-delivery_method co-input-wrapper co-toggable_field co-toggable_field--bordered" for="order_delivery_variant_id_766248">
                                            <span class="radio co-delivery_method-input co-toggable_field-input co-toggable_field-input--radio">
                                                <input checked="checked" class="radio_button" data-delivery-id="766248" id="order_delivery_variant_id_766248" name="order[delivery_variant_id]" rel="#price_766248" type="radio" value="766248" style="cursor: pointer; opacity: 1;">
                                                <span>
                                                </span>
                                            </span>
                                            <span class="co-toggable_field-information co-delivery_method-information">
                                                <span class="co-delivery_method-title co-toggable_field-title co-input-title" id="delivery_title_766248">Самовывоз</span>
                                                <span class="co-delivery_method-description co-toggable_field-description co-input-description" id="delivery_description_766248">
                                                    <p>На пункте выдачи</p>
                                                </span>
                                            </span>
                                            <span class="co-delivery_method-price co-toggable_field-price co-price--current" id="price_766248" data-price="0">+ 0&nbsp;руб</span>
                                            <span class="co-delivery_method-price co-toggable_field-price co-price--current" id="price_range_766248" style="display: none"></span>
                                        </label>
                                        <label class="co-delivery_method co-input-wrapper co-toggable_field co-toggable_field--bordered" for="order_delivery_variant_id_766247">
                                            <span class="radio co-delivery_method-input co-toggable_field-input co-toggable_field-input--radio">
                                                <input class="radio_button js-input-field" data-delivery-id="766247" id="order_delivery_variant_id_766247" name="order[delivery_variant_id]" rel="#price_766247" type="radio" value="766247" style="cursor: pointer; opacity: 1;">
                                                <span>
                                                </span>
                                            </span>
                                            <span class="co-toggable_field-information co-delivery_method-information">
                                                <span class="co-delivery_method-title co-toggable_field-title co-input-title" id="delivery_title_766247">Почта России</span>
                                                <span class="co-delivery_method-description co-toggable_field-description co-input-description" id="delivery_description_766247">
                                                    <p>Доставка почтой&nbsp;</p>
                                                </span>
                                            </span>
                                            <span class="co-delivery_method-price co-toggable_field-price co-price--current" id="price_766247" data-price="200">+ 200&nbsp;руб</span>
                                            <span class="co-delivery_method-price co-toggable_field-price co-price--current" id="price_range_766247" style="display: none"></span>
                                        </label><div class="co-modal co-modal--outlet co-modal--fixed co-modal--hide">
                                            <!--радиобаттомы-->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <button class="co-button co-button--checkout">Подтвердить заказ</button>
                        </form>
                    </div>
                </div>
            }
        </div>
    </div>
</body>
</html>

@code {
    string email;
    string name, name2, name3, phone;
    int count = 0;
    double summ = 0;
    public IList<Buyer> buyer;
    protected override async Task OnInitializedAsync()
    {
        email = await oLocalStore.GetItemAsync<string>("MySessionValue");
        buyer = Service.GetBuyer();
        foreach (var i in buyer)
        {
            if (i.Emailbuyer == email)
            {
                name = i.First;
                name2 = i.Second;
                name3 = i.Third;
                phone = i.Telephonebuyer;
            }
        }

        foreach(var i in Header.addcart)
        {
            //i.Picture = PickerVariantsdf;
            summ += Convert.ToDouble(i.Price) * Header.addcartqu[count];
            count++;

        }
        count = 0;
    }
    public async void ClearSession()
    {
        Header.addcart.Clear();
        Header.addcartqu.Clear();
        Header.changeemail(null);
        Header.Email = null;
        await oLocalStore.ClearAsync();
        NavigationManager.NavigateTo("/");
    }//очистка сессии

    public void click()
    {
        NavigationManager.NavigateTo("/Auth");
    }
    public void clicktocat()
    {
        NavigationManager.NavigateTo("/Catalog");
    }
}
